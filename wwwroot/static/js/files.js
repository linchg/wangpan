$(function(){$("#listviewfilelist tr").mouseover(function(){$(this).addClass("sel-tr");$(this).children(".tr .sharestatus").children("#rename").removeClass("dn");});$("#listviewfilelist tr").mouseout(function(){$(this).removeClass("sel-tr");$(this).children(".tr .sharestatus").children("#rename").addClass("dn");});$("input[name='fid']").click(function(){if($(this).attr("checked")){$(this).attr("checked",false);}else{$(this).attr("checked",true);}});$("#listviewfilelist tr").click(function(){if($(this).children(".select-file").children("#fid").attr("checked"))
$(this).children(".select-file").children("#fid").attr("checked",false);else
$(this).children(".select-file").children("#fid").attr("checked",true);var j=0;$("[name='fid']").each(function(){if($(this).attr("checked")){j=j+1;$("#wjm").addClass("dn");$("#movedel").removeClass("dn");$("#wjm1").addClass("dn");$("#movedel1").removeClass("dn");return false;}});if(j==0){$("#movedel").addClass("dn");$("#wjm").removeClass("dn");$("#movedel1").addClass("dn");$("#wjm1").removeClass("dn");}});$("#chk_all1").click(function(){$("input[name='fid']").attr("checked",$(this).attr("checked"));$("#chk_all2").attr("checked",$(this).attr("checked"));if($(this).attr("checked")){$("#wjm").addClass("dn");$("#movedel").removeClass("dn");$("#wjm1").addClass("dn");$("#movedel1").removeClass("dn");}else{$("#movedel").addClass("dn");$("#wjm").removeClass("dn");$("#movedel1").addClass("dn");$("#wjm1").removeClass("dn");}});$("#chk_all2").click(function(){$("input[name='fid']").attr("checked",$(this).attr("checked"));$("#chk_all1").attr("checked",$(this).attr("checked"));if($(this).attr("checked")){$("#wjm").addClass("dn");$("#movedel").removeClass("dn");$("#wjm1").addClass("dn");$("#movedel1").removeClass("dn");}else{$("#movedel").addClass("dn");$("#wjm").removeClass("dn");$("#movedel1").addClass("dn");$("#wjm1").removeClass("dn");}});$("#mrqd").click(function(){var m_submit="qiandao";$.ajax({url:'file_post.php',type:'post',data:{type:m_submit},dataType:'text',error:function(){alert('签到失败。');return false;},success:function(result){if(result=="true"){var jf=parseInt($("#jifen").html());$("#jifen").html(jf+1);floatdiv("签到成功。","#");}else if(result=="retrue"){floatdiv("请不要重复签到。","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{floatdiv("签到失败","#");document.getElementById("mrqd").disabled=false;}}});document.getElementById("mrqd").disabled=true;});$("#lastdown").click(function(){var m_submit="lastdown";$.ajax({url:'info_post.php',type:'post',data:{type:m_submit},dataType:'text',error:function(){alert('读取失败。');return false;},success:function(result){if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{show_lastdown(result);}}});});$("#upload").click(function(){uploads();});$("#newdir").click(function(){newfolder(folder);});$("#newdirc").click(function(){alert("确定了");});})
function fLen(Obj){var nCNLenth=0;var nLenth=Obj.length;for(var i=0;i<nLenth;i++){if(Obj.charCodeAt(i)>255){nCNLenth+=2;}else{nCNLenth++;}}
return nCNLenth;}
function is_blank(str){var reg=/^\s*$/;return reg.test(str);}
function cal(str){re=/ /g;if(re.test(str))
return str.match(re).length;else
return 0;}
function muluaddForm(){var voidChar='\'\\/"<>:?|';var addmulu=$.trim($("#addmulu").val());if(addmulu==""){floatdiv("请输入文件夹名称","#");return false;}else if(fLen(addmulu)<2){floatdiv("文件夹名请大于2字节","#");return false;}else if(fLen(addmulu)>20){floatdiv("文件夹名请小于20字节","#");return false;}
for(i=0;i<voidChar.length;i++){aChar=voidChar.substring(i,i+1);if(addmulu.indexOf(aChar)>-1){floatdiv("文件夹名请勿包含 "+aChar+" 字符","#");return false;}}
var m_submit="add_mulu";$.ajax({url:'file_post.php',type:'post',data:{name:addmulu,folderid:$.trim($("#folderid").val()),type:m_submit},dataType:'text',error:function(){alert('文件夹添加失败,请稍候再试!');return false;},success:function(result){if(result=="true"){closeForm();floatdiv("文件夹添加成功",location.href);}else if(result=="err"){floatdiv("非法提交","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else if(result=="muluc"){floatdiv("最多创建 3 级文件夹!","#");}else{floatdiv("文件夹添加失败","#");document.getElementById("btnaddmulu").disabled=false;}}});document.getElementById("btnaddmulu").disabled=false;}
function mulumodForm(){var voidChar='\'\\/"<>:?|';var editmulu=$.trim($("#modmulu").val());if(editmulu==$.trim($("#muluedit").val())){closeForm();return false;}
if(editmulu==""){floatdiv("请输入文件夹名称","#");return false;}else if(fLen(editmulu)<2){floatdiv("文件夹名请大于2字节","#");return false;}else if(fLen(editmulu)>20){floatdiv("文件夹名请小于20字节","#");return false;}
for(i=0;i<voidChar.length;i++){aChar=voidChar.substring(i,i+1);if(editmulu.indexOf(aChar)>-1){floatdiv("文件夹名请勿包含 "+aChar+" 字符","#");return false;}}
var m_submit="mod_mulu";$.ajax({url:'file_post.php',type:'post',data:{id:$("#folderid").val(),name:editmulu,type:m_submit},dataType:'text',error:function(){alert('文件夹修改失败,请稍候再试!');return false;},success:function(result){if(result=="true"){closeForm();floatdiv("文件夹修改成功",location.href);}else if(result=="err"){floatdiv("非法提交","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{floatdiv("文件夹修改失败","#");document.getElementById("btneditmulu").disabled=false;}}});document.getElementById("btneditmulu").disabled=true;}
function muludelForm(id,filenum){if(filenum>0){floatdiv("文件夹内有文件删除失败","#");return false;}
var m_submit="del_mulu";$.ajax({url:'file_post.php',type:'post',data:{id:id,type:m_submit},dataType:'text',error:function(){alert('文件夹删除失败,请稍候再试!');return false;},success:function(result){if(result=="true"){closeForm();floatdiv("文件夹删除成功",location.href);}else if(result=="err"){floatdiv("非法提交","#");}else if(result=="max"){floatdiv("文件夹内有子文件夹 删除失败","#");document.getElementById("btndelmulu").disabled=false;}else if(result=="filenum"){floatdiv("文件夹内有文件 删除失败","#");document.getElementById("btndelmulu").disabled=false;}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{floatdiv("文件夹删除失败","#");document.getElementById("btndelmulu").disabled=false;}}});document.getElementById("btndelmulu").disabled=true;}
function mulugxinForm(id){var m_submit="gxin_mulu";$.ajax({url:'file_post.php',type:'post',data:{id:id,type:m_submit},dataType:'text',error:function(){alert('文件夹更新失败,请稍候再试!');return false;},success:function(result){if(result=="true"){floatdiv("文件夹更新成功",location.href);}else if(result=="err"){floatdiv("非法提交","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{floatdiv("文件夹更新失败","#");document.getElementById("btngxinmulu").disabled=false;}}});document.getElementById("btngxinmulu").disabled=true;}
function fileeditForm(id){var voidChar='\'\\/"<>:?|';var xg_name=document.getElementById("xg_name").value;var xg_content=document.getElementById("xg_content").value.replace("文件描述,不得大于2000个字节(即1000个汉字)","");if(document.getElementById("xg_name").value==""){floatdiv("请输入文件名","#");return false;}
if(is_blank(xg_name)&&fLen(xg_name)>0){floatdiv("文件名不能全是空格","#");return false;}
if(fLen(xg_name)<5&&fLen(xg_name)>0){floatdiv("文件名称必须大于 5 字节","#");return false;}
if(fLen(xg_name)>200&&fLen(xg_name)>0){floatdiv("文件名称必须小于 200 字节","#");return false;}
for(i=0;i<voidChar.length;i++){aChar=voidChar.substring(i,i+1);if(xg_name.indexOf(aChar)>-1){floatdiv("文件名请勿包含 "+aChar+" 字符","#");return false;}}
if(is_blank(xg_content)&&fLen(xg_content)>0){floatdiv("文件介绍不能全是空格","#");return false;}
if(fLen(xg_content)<10&&fLen(xg_content)>0){floatdiv("文件介绍必须大于 10 字节","#");return false;}
if(fLen(xg_content)>2000&&fLen(xg_content)>0){floatdiv("文件介绍必须小于 2000 字节","#");return false;}
var m_submit="edit_file";$.ajax({url:'file_post.php',type:'post',data:{xg_id:id,xg_name:$.trim($("#xg_name").val()),xg_content:$.trim($("#xg_content").val()).replace("文件描述,不得大于2000个字节(即1000个汉字)",""),type:m_submit},dataType:'text',error:function(){alert('文件修改失败,请稍候再试!');},success:function(result){if(result=="true"){floatdiv("文件修改成功!",location.href);}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else if(result=="err"){floatdiv("非法提交!",location.href);}else{floatdiv("文件修改失败","#");document.getElementById("btnxgfile").disabled=false;}}});document.getElementById("btnxgfile").disabled=true;}
function del_file(id,dirid){if(dirid==''&&dirid!=0){floatdiv("参数错误","#");return false;}
if(id==''&&id!=0){floatdiv("参数错误","#");return false;}
if(id!=""){if(!confirm('删除后无法恢复了，您确定要删除这些文件吗？'))return
var m_submit="del_file";$.ajax({url:'file_post.php',type:'post',data:{delid:id,dirid:dirid,type:m_submit},dataType:'text',error:function(){alert('文件删除失败,请稍候再试!');},success:function(result){if(result=="true"){floatdiv("文件删除成功",location.href);}else if(result=="err"){floatdiv("非法提交","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{floatdiv("文件删除失败","#");}}});}else{floatdiv("请选择要删除的文件","#");}}
function del_filearr(dirid){if(dirid==''&&dirid!=0){floatdiv("参数错误","#");return false;}
var delid="";var arr=document.getElementsByName("fid");if(arr){for(var i=0;i<arr.length;i++){var ele=arr[i];if(ele.checked){delid+=","+ele.value;}}}
if(delid!=""){if(!confirm('删除后无法恢复了，您确定要删除这些文件吗？'))return
var m_submit="del_filearr";$.ajax({url:'file_post.php',type:'post',data:{delid:delid.substring(1,delid.length),dirid:dirid,type:m_submit},dataType:'text',error:function(){alert('文件删除失败,请稍候再试!');},success:function(result){if(result=="true"){floatdiv("文件删除成功",location.href);}else if(result=="err"){floatdiv("非法提交","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{floatdiv("文件删除失败","#");}}});}else{floatdiv("请选择要删除的文件","#");}}
function fileyidForm(){if($("#folderid").val()==''){floatdiv("参数错误","#");return false;}
if($("#mvdir").val()==''){floatdiv("参数错误","#");return false;}
if($("#fileid").val()==''){floatdiv("参数错误","#");return false;}
var yesno=$("#fileid").val().indexOf(',')<0?'NO':'YES';if(yesno=="NO"){if($("#mvdir").val()==$("#folderid").val()){floatdiv("文件移动成功","#");setTimeout('closeForm()',1500);document.getElementById("btnyidfile").disabled=false;return false;}}
var m_submit="yid_file";$.ajax({url:'file_post.php',type:'post',data:{muluid:$("#folderid").val(),dirid:$("#mvdir").val(),fileid:$("#fileid").val(),type:m_submit},dataType:'text',error:function(){alert('文件移动失败,请稍候再试!');},success:function(result){if(result=="true"){floatdiv("文件移动成功",location.href);}else if(result=="err"){floatdiv("非法提交","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{floatdiv("文件移动失败","#");document.getElementById("btnyidfile").disabled=false;}}});document.getElementById("btnyidfile").disabled=true;}
function link_urlarr(fz){var linkid="";var arr=document.getElementsByName("fid");if(arr){for(var i=0;i<arr.length;i++){var ele=arr[i];if(ele.checked){linkid+=","+ele.value;}}}
if(linkid!=""){var m_submit="get_urlarr";$.ajax({url:'file_post.php',type:'post',data:{arrid:linkid.substring(1,linkid.length),fz:fz,type:m_submit},dataType:'text',error:function(){alert('提取地址,请稍候再试!');return false;},success:function(result){if(result=="err"){floatdiv("非法提交","#");}else if(result=="login"){floatdiv("登陆超时!","http://"+location.hostname+"/");}else{get_link_urlarr(result);}}});}else{floatdiv("请选择要提取的网址","#");return false;}}